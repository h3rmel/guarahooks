#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

cd -- "$(git rev-parse --show-toplevel)" || exit 1

# Detect if pnpm-lock.yaml changed in the last merge and install deps if needed
if git rev-parse -q --verify HEAD@{1} >/dev/null 2>&1; then
  CHANGED="$(git diff --name-only HEAD@{1} HEAD -- pnpm-lock.yaml)"
else
  CHANGED=""
fi

if [ -n "$CHANGED" ]; then
  echo "Detected changes in pnpm-lock.yaml. Running pnpm install..."
  if ! command -v pnpm >/dev/null 2>&1; then
    echo "pnpm is required but not found. Please install pnpm and run 'pnpm install'."
    exit 0
  fi
  pnpm install
fi

exit 0

